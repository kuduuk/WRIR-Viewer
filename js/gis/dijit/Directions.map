{"version":3,"file":"Directions.js","sources":["Directions.js"],"names":["define","declare","_WidgetBase","_TemplatedMixin","Directions","template","lang","Menu","MenuItem","PopupMenuItem","MenuSeparator","Point","SpatialReference","topic","i18n","templateString","postCreate","this","inherited","arguments","directions","mixin","map","options","directionsNode","startup","_activateButton","style","display","_activateButtonNode","_addDestinationNode","_optionsButtonNode","marginRight","mapRightClickMenu","addRightClickMenu","on","hitch","evt","mapRightClickPoint","mapPoint","menu","addChild","label","labels","directionsFromHere","onClick","directionsToHere","addStop","useMyLocationAsStart","useMyLocationAsEnd","popup","clearStops","reset","directionsFrom","updateStop","then","directionsTo","stops","length","doRoute","parentWidget","open","toggle","getDirections","startAtMyLocation","getGeoLocation","endAtMyLocation","leg","navigator","geolocation","getCurrentPosition","publish","title","errors","geoLocation","message","level","timeout","opacity","locationSuccess","event","coords","longitude","latitude","wkid","locationError","error","location"],"mappings":";;;;;AAAAA,QACG,qBACA,oBACA,wBACA,wBACA,mDACA,kBACA,aACA,iBACA,sBACA,sBACA,sBACA,wBACA,aACA,uCACA,SAAUC,EAASC,EAAaC,EAAiBC,EAAYC,EAAUC,EAAMC,EAAMC,EAAUC,EAAeC,EAAeC,EAAOC,EAAkBC,EAAOC,GAE1J,MAAOb,IAASC,EAAaC,IACzBY,eAAgBV,EAChBS,KAAMA,EACNE,WAAY,WACRC,KAAKC,UAAUC,WACfF,KAAKG,WAAa,GAAIhB,GAAWE,EAAKe,OAClCC,IAAKL,KAAKK,KACXL,KAAKM,SAAUN,KAAKO,gBACvBP,KAAKG,WAAWK,UAGZR,KAAKG,WAAWM,gBAChBT,KAAKG,WAAWM,gBAAgBC,MAAMC,QAAU,OACzCX,KAAKG,WAAWS,sBACvBZ,KAAKG,WAAWS,oBAAoBF,MAAMC,QAAU,OACpDX,KAAKG,WAAWU,oBAAoBH,MAAM,SAAW,UACrDV,KAAKG,WAAWW,mBAAmBJ,MAAM,SAAW,UACpDV,KAAKG,WAAWW,mBAAmBJ,MAAMK,YAAc,OAGvDf,KAAKgB,mBACLhB,KAAKiB,qBAGbA,kBAAmB,WAEfjB,KAAKK,IAAIa,GAAG,YAAa7B,EAAK8B,MAAMnB,KAAM,SAAUoB,GAChDpB,KAAKqB,mBAAqBD,EAAIE,YAGlCtB,KAAKuB,KAAO,GAAIjC,GAChBU,KAAKuB,KAAKC,SAAS,GAAIjC,IACnBkC,MAAOzB,KAAKH,KAAK6B,OAAOC,mBACxBC,QAASvC,EAAK8B,MAAMnB,KAAM,qBAE9BA,KAAKuB,KAAKC,SAAS,GAAIjC,IACnBkC,MAAOzB,KAAKH,KAAK6B,OAAOG,iBACxBD,QAASvC,EAAK8B,MAAMnB,KAAM,mBAE9BA,KAAKuB,KAAKC,SAAS,GAAI/B,IACvBO,KAAKuB,KAAKC,SAAS,GAAIjC,IACnBkC,MAAOzB,KAAKH,KAAK6B,OAAOI,QACxBF,QAASvC,EAAK8B,MAAMnB,KAAM,cAE9BA,KAAKuB,KAAKC,SAAS,GAAI/B,IACvBO,KAAKuB,KAAKC,SAAS,GAAIjC,IACnBkC,MAAOzB,KAAKH,KAAK6B,OAAOK,qBACxBH,QAASvC,EAAK8B,MAAMnB,KAAM,iBAAkB,qBAEhDA,KAAKuB,KAAKC,SAAS,GAAIjC,IACnBkC,MAAOzB,KAAKH,KAAK6B,OAAOM,mBACxBJ,QAASvC,EAAK8B,MAAMnB,KAAM,iBAAkB,mBAIhDA,KAAKgB,kBAAkBQ,SAAS,GAAIhC,IAChCiC,MAAOzB,KAAKH,KAAK6B,OAAOvB,WACxB8B,MAAOjC,KAAKuB,SAGpBW,WAAY,WACRlC,KAAKG,WAAWgC,SAEpBC,eAAgB,WACZpC,KAAKG,WAAWkC,WAAWrC,KAAKqB,mBAAoB,GAAGiB,KAAKjD,EAAK8B,MAAMnB,KAAM,aAEjFuC,aAAc,WACVvC,KAAKG,WAAWkC,WAAWrC,KAAKqB,mBAAoBrB,KAAKG,WAAWqC,MAAMC,OAAS,GAAGH,KAAKjD,EAAK8B,MAAMnB,KAAM,aAEhH8B,QAAS,WACL9B,KAAKG,WAAW2B,QAAQ9B,KAAKqB,mBAAoBrB,KAAKG,WAAWqC,MAAMC,OAAS,GAAGH,KAAKjD,EAAK8B,MAAMnB,KAAM,aAE7G0C,QAAS,WACD1C,KAAK2C,eAAiB3C,KAAK2C,aAAaC,MACxC5C,KAAK2C,aAAaE,SAElB7C,KAAKG,WAAWqC,MAAM,IAAMxC,KAAKG,WAAWqC,MAAM,IAClDxC,KAAKG,WAAW2C,iBAGxBC,kBAAmB,WACf/C,KAAKgD,eAAe,mBAExBC,gBAAiB,WACbjD,KAAKgD,eAAe,iBAExBA,eAAgB,SAAUE,GAClBC,WAAaA,UAAUC,YACvBD,UAAUC,YAAYC,mBAAmBhE,EAAK8B,MAAMnB,KAAM,kBAAmBkD,GAAM7D,EAAK8B,MAAMnB,KAAM,kBAEpGJ,EAAM0D,QAAQ,iBACVC,MAAOvD,KAAKH,KAAK2D,OAAOC,YAAYF,MACpCG,QAAS1D,KAAKH,KAAK2D,OAAOC,YAAYC,QACtCC,MAAO,UACPC,QAAS,IACTC,QAAS,KAIrBC,gBAAiB,SAAUZ,EAAKa,GAC5B/D,KAAKqB,mBAAqB,GAAI3B,GAAMqE,EAAMC,OAAOC,UAAWF,EAAMC,OAAOE,SAAU,GAAIvE,IACnFwE,KAAM,QAEVnE,KAAKkD,MAETkB,cAAe,SAAUC,GACrBzE,EAAM0D,QAAQ,iBACVC,MAAOvD,KAAKH,KAAK2D,OAAOc,SAASf,MACjCG,QAAS1D,KAAKH,KAAK2D,OAAOc,SAASZ,QAAUW,EAAMX,QACnDC,MAAO,UACPC,QAAS,IACTC,QAAS","sourcesContent":["define([\n   'dojo/_base/declare',\n   'dijit/_WidgetBase',\n   'dijit/_TemplatedMixin',\n   'esri/dijit/Directions',\n   'dojo/text!./Directions/templates/Directions.html',\n   'dojo/_base/lang',\n   'dijit/Menu',\n   'dijit/MenuItem',\n   'dijit/PopupMenuItem',\n   'dijit/MenuSeparator',\n   'esri/geometry/Point',\n   'esri/SpatialReference',\n   'dojo/topic',\n   'dojo/i18n!./Directions/nls/resource'\n], function (declare, _WidgetBase, _TemplatedMixin, Directions, template, lang, Menu, MenuItem, PopupMenuItem, MenuSeparator, Point, SpatialReference, topic, i18n) {\n\n    return declare([_WidgetBase, _TemplatedMixin], {\n        templateString: template,\n        i18n: i18n,\n        postCreate: function () {\n            this.inherited(arguments);\n            this.directions = new Directions(lang.mixin({\n                map: this.map\n            }, this.options), this.directionsNode);\n            this.directions.startup();\n\n             //temp fix for 3.12 and 3.13 map click button.\n            if (this.directions._activateButton) {\n                this.directions._activateButton.style.display = 'none';\n            } else if (this.directions._activateButtonNode) {\n                this.directions._activateButtonNode.style.display = 'none';\n                this.directions._addDestinationNode.style['float'] = 'inherit';\n                this.directions._optionsButtonNode.style['float'] = 'inherit';\n                this.directions._optionsButtonNode.style.marginRight = '5px';\n            }\n\n            if (this.mapRightClickMenu) {\n                this.addRightClickMenu();\n            }\n        },\n        addRightClickMenu: function () {\n            // capture map right click position\n            this.map.on('MouseDown', lang.hitch(this, function (evt) {\n                this.mapRightClickPoint = evt.mapPoint;\n            }));\n\n            this.menu = new Menu();\n            this.menu.addChild(new MenuItem({\n                label: this.i18n.labels.directionsFromHere,\n                onClick: lang.hitch(this, 'directionsFrom')\n            }));\n            this.menu.addChild(new MenuItem({\n                label: this.i18n.labels.directionsToHere,\n                onClick: lang.hitch(this, 'directionsTo')\n            }));\n            this.menu.addChild(new MenuSeparator());\n            this.menu.addChild(new MenuItem({\n                label: this.i18n.labels.addStop,\n                onClick: lang.hitch(this, 'addStop')\n            }));\n            this.menu.addChild(new MenuSeparator());\n            this.menu.addChild(new MenuItem({\n                label: this.i18n.labels.useMyLocationAsStart,\n                onClick: lang.hitch(this, 'getGeoLocation', 'directionsFrom')\n            }));\n            this.menu.addChild(new MenuItem({\n                label: this.i18n.labels.useMyLocationAsEnd,\n                onClick: lang.hitch(this, 'getGeoLocation', 'directionsTo')\n            }));\n\n            // add this widgets menu as a sub menu to the map right click menu\n            this.mapRightClickMenu.addChild(new PopupMenuItem({\n                label: this.i18n.labels.directions,\n                popup: this.menu\n            }));\n        },\n        clearStops: function () {\n            this.directions.reset();\n        },\n        directionsFrom: function () {\n            this.directions.updateStop(this.mapRightClickPoint, 0).then(lang.hitch(this, 'doRoute'));\n        },\n        directionsTo: function () {\n            this.directions.updateStop(this.mapRightClickPoint, this.directions.stops.length - 1).then(lang.hitch(this, 'doRoute'));\n        },\n        addStop: function () {\n            this.directions.addStop(this.mapRightClickPoint, this.directions.stops.length - 1).then(lang.hitch(this, 'doRoute'));\n        },\n        doRoute: function () {\n            if (this.parentWidget && !this.parentWidget.open) {\n                this.parentWidget.toggle();\n            }\n            if (this.directions.stops[0] && this.directions.stops[1]) {\n                this.directions.getDirections();\n            }\n        },\n        startAtMyLocation: function () {\n            this.getGeoLocation('directionsFrom');\n        },\n        endAtMyLocation: function () {\n            this.getGeoLocation('directionsTo');\n        },\n        getGeoLocation: function (leg) {\n            if (navigator && navigator.geolocation) {\n                navigator.geolocation.getCurrentPosition(lang.hitch(this, 'locationSuccess', leg), lang.hitch(this, 'locationError'));\n            } else {\n                topic.publish('growler/growl', {\n                    title: this.i18n.errors.geoLocation.title,\n                    message: this.i18n.errors.geoLocation.message,\n                    level: 'default',\n                    timeout: 10000,\n                    opacity: 1.0\n                });\n            }\n        },\n        locationSuccess: function (leg, event) {\n            this.mapRightClickPoint = new Point(event.coords.longitude, event.coords.latitude, new SpatialReference({\n                wkid: 4326\n            }));\n            this[leg]();\n        },\n        locationError: function (error) {\n            topic.publish('growler/growl', {\n                title: this.i18n.errors.location.title,\n                message: this.i18n.errors.location.message + error.message,\n                level: 'default',\n                timeout: 10000,\n                opacity: 1.0\n            });\n        }\n    });\n});"]}
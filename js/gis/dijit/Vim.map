{"version":3,"file":"Vim.js","sources":["Vim.js"],"names":["define","declare","kernel","cookie","JSON","baseUnload","lang","constructor","idStateName","this","addOnUnload","hitch","loadCredentials","idJson","idObject","_supportsLocalStorage","window","localStorage","getItem","length","parse","id","initialize","storeCredentials","credentials","idString","stringify","toJson","setItem","expires","e"],"mappings":";;;;;AAOAA,QACC,qBACA,cACA,cACA,YACA,oBACA,mBACE,SAASC,EAASC,EAAQC,EAAQC,EAAMC,EAAYC,GACtD,MAAOL,GAAQ,MACdM,YAAa,SAASC,GACrBC,KAAKD,YAAcA,GAAe,6BAClCH,EAAWK,YAAYJ,EAAKK,MAAMF,KAAM,qBACxCA,KAAKG,mBAENA,gBAAiB,WAChB,GAAIC,GAAQC,CAEXD,GADGJ,KAAKM,wBACCC,OAAOC,aAAaC,QAAQT,KAAKD,aAEjCL,EAAOM,KAAKD,aAElBK,GAAoB,QAAVA,GAAoBA,EAAOM,OAAS,IACjDL,EAAWV,EAAKgB,MAAMP,GACtBX,EAAOmB,GAAGC,WAAWR,KAGvBS,iBAAkB,WACjB,GAAqC,IAAjCrB,EAAOmB,GAAGG,YAAYL,OAA1B,CAGA,GAAIM,GAAWrB,EAAKsB,UAAUxB,EAAOmB,GAAGM,SACpClB,MAAKM,wBACRC,OAAOC,aAAaW,QAAQnB,KAAKD,YAAaiB,GAE9CtB,EAAOM,KAAKD,YAAaiB,GACxBI,QAAS,MAIZd,sBAAuB,WACtB,IACC,MAAO,gBAAkBC,SAAkC,OAAxBA,OAAOC,aACzC,MAAOa,GACR,OAAO","sourcesContent":["// Vim.js\n// Used to serialize/deserialize the identitymanager storing\n// credential objects (tokens) in either local storage or a cookie\n// usage:\n//\tparam 1: the name of the cookie/localstorage key\n//\tnew Vim(idStateName);\n\ndefine([\n\t'dojo/_base/declare',\n\t'esri/kernel',\n\t'dojo/cookie',\n\t'dojo/json',\n\t'dojo/_base/unload',\n\t'dojo/_base/lang'\n], function(declare, kernel, cookie, JSON, baseUnload, lang) {\n\treturn declare(null, {\n\t\tconstructor: function(idStateName) {\n\t\t\tthis.idStateName = idStateName || 'esri_jsapi_id_manager_data';\n\t\t\tbaseUnload.addOnUnload(lang.hitch(this, 'storeCredentials'));\n\t\t\tthis.loadCredentials();\n\t\t},\n\t\tloadCredentials: function() {\n\t\t\tvar idJson, idObject;\n\t\t\tif (this._supportsLocalStorage()) {\n\t\t\t\tidJson = window.localStorage.getItem(this.idStateName);\n\t\t\t} else {\n\t\t\t\tidJson = cookie(this.idStateName);\n\t\t\t}\n\t\t\tif (idJson && idJson != 'null' && idJson.length > 4) {\n\t\t\t\tidObject = JSON.parse(idJson);\n\t\t\t\tkernel.id.initialize(idObject);\n\t\t\t}\n\t\t},\n\t\tstoreCredentials: function() {\n\t\t\tif (kernel.id.credentials.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar idString = JSON.stringify(kernel.id.toJson());\n\t\t\tif (this._supportsLocalStorage()) {\n\t\t\t\twindow.localStorage.setItem(this.idStateName, idString);\n\t\t\t} else {\n\t\t\t\tcookie(this.idStateName, idString, {\n\t\t\t\t\texpires: 1\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t_supportsLocalStorage: function() {\n\t\t\ttry {\n\t\t\t\treturn 'localStorage' in window && window.localStorage !== null;\n\t\t\t} catch (e) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t});\n});\n"]}